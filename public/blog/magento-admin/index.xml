<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Magento Admin on KALPESH MEHTA</title>
    <link>http://localhost:1313/blog/magento-admin/</link>
    <description>Recent content in Magento Admin on KALPESH MEHTA</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <managingEditor>k@lpe.sh (Kalpesh Mehta)</managingEditor>
    <webMaster>k@lpe.sh (Kalpesh Mehta)</webMaster>
    <copyright>Copyright © 2025 kalpesh mehta</copyright>
    <lastBuildDate>Tue, 07 Oct 2014 23:09:09 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/blog/magento-admin/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Magento fix for error &#34;Code already exists.&#34;</title>
      <link>http://localhost:1313/magento-fix-for-error-code-already-exists./</link>
      <pubDate>Tue, 07 Oct 2014 23:09:09 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-fix-for-error-code-already-exists./</guid>
      <description>&lt;p&gt;Fix for Magento error &lt;strong&gt;Code already exists.&lt;/strong&gt; in Sales &amp;gt; Tax &amp;gt; Manage Tax Rules, when saving the rule.&lt;/p&gt;&#xA;&lt;p&gt;When trying to save Tax rules in Magento, you may get “Code already exists.” error if there are lots of tax rates passing in POST. Magento error is not making sense here, as the issue is something different. Basically when you post the data in PHP, it limits maximum post variables which should pass to the server. For me, that limit was 1000 in max_input_vars, which by changing to 20000 solved this issue and Magento successfully accepted my changes without any error.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Fix for Magento error <strong>Code already exists.</strong> in Sales &gt; Tax &gt; Manage Tax Rules, when saving the rule.</p>
<p>When trying to save Tax rules in Magento, you may get “Code already exists.” error if there are lots of tax rates passing in POST. Magento error is not making sense here, as the issue is something different. Basically when you post the data in PHP, it limits maximum post variables which should pass to the server. For me, that limit was 1000 in max_input_vars, which by changing to 20000 solved this issue and Magento successfully accepted my changes without any error.</p>
<p>To change max_input_vars to higher value, you need to edit in PHP.ini file for max_input_vars like this:<br>




<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"> max_input_vars 20000</span></span></span></code></pre></div></p>
<p>But as editing PHP.ini requires restarting apache to reflect the changes, I did the change in .htaccess file just for Tax rule modification and later reverted it.</p>
<p>You can edit .htaccess to make this change by copy-pasting below line at the end of the file:<br>




<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"> php_value max_input_vars 20000</span></span></span></code></pre></div></p>
<p>Now you should be able to change Tax rules even if you have lots of tax rates posting through for that change! I prefered to revert .htaccess back to what it was as I didn’t need to change tax rules frequently.</p>
<p>Note: If the above does not solve the issue for you, make sure your Tax Rule name is not duplicating with another tax rule name.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Magento: Show gift card details in admin order page</title>
      <link>http://localhost:1313/magento-show-gift-card-details-in-admin-order-page/</link>
      <pubDate>Tue, 23 Sep 2014 20:13:07 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-show-gift-card-details-in-admin-order-page/</guid>
      <description>&lt;p&gt;Magento display gift card details (code and amount) in Order View page of admin panel. When customer uses gift card in their order Magento does not display gift card code and amount details in admin panel which makes it tough to know. Customer can pay partially through gift card which makes even tougher as Magento only shows payment information of other method and not gift card amount deductions.&lt;/p&gt;&#xA;&lt;p&gt;Below code will show you an additional block in magento admin panel with Gift Card details. If gift card is not used in an order, the block will simply no shown.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Magento display gift card details (code and amount) in Order View page of admin panel. When customer uses gift card in their order Magento does not display gift card code and amount details in admin panel which makes it tough to know. Customer can pay partially through gift card which makes even tougher as Magento only shows payment information of other method and not gift card amount deductions.</p>
<p>Below code will show you an additional block in magento admin panel with Gift Card details. If gift card is not used in an order, the block will simply no shown.</p>
<p>Open the file app/design/adminhtml/default/default/template/sales/order/view/edit.phtml</p>
<p>Add the below lines of code anywhere you want the gift card block to appear. I have used it after Account Information block.</p>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#666">&lt;?</span>php <span style="color:#b8860b">$cards</span> <span style="color:#666">=</span> unserialize(<span style="color:#b8860b">$_order</span><span style="color:#666">-&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#b44">getGiftCards</span>());  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">if</span>(<span style="color:#b8860b">$cards</span><span style="color:#666">!=</span>” <span style="color:#666">&amp;</span>amp;<span style="color:#666">&amp;</span>amp; count(<span style="color:#b8860b">$cards</span>)<span style="color:#666">&gt;</span><span style="color:#666">0</span>) { <span style="color:#080">?&gt;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">&lt;div class=&#34;box-left&#34;&gt;&lt;div class=&#34;entry-edit&#34;&gt;&lt;div class=&#34;entry-edit-head&#34;&gt;#### &lt;?php echo Mage::helper(&#39;sales&#39;)-&gt;
</span></span></span><span style="display:flex;"><span><span style="">__(‘Gift Cards’) ?&gt;
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">&lt;/div&gt;&lt;div class=&#34;fieldset&#34;&gt;&lt;div class=&#34;hor-scroll&#34;&gt;&lt;?php foreach ($cards as $card) { ??&gt;
</span></span></span><span style="display:flex;"><span><span style="">| &lt;label&gt;&lt;?php echo Mage::helper(&#39;sales&#39;)-&gt; __(‘Giftcard Code’) ?&gt;&lt;/label&gt; | &lt;div style=&#34;font-weight:bold&#34;&gt;&lt;?php echo $card[&#39;c&#39;];??&gt; &lt;/div&gt; |
</span></span></span><span style="display:flex;"><span><span style="">|---|---|
</span></span></span><span style="display:flex;"><span><span style="">| &lt;label&gt;&lt;?php echo Mage::helper(&#39;sales&#39;)-&gt; __(‘Giftcard Amount’) ?&gt;&lt;/label&gt; | &lt;div style=&#34;font-weight:bold&#34;&gt;&lt;?php echo $card[&#39;a&#39;];??&gt; &lt;/div&gt; |
</span></span></span><span style="display:flex;"><span><span style=""> &lt;?php }??&gt;
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;?php }??&gt;
</span></span></span></code></pre></div>
]]></content:encoded>
    </item>
    <item>
      <title>Magento: Save shipment information of order programatically</title>
      <link>http://localhost:1313/magento-save-shipment-information-of-order-programatically/</link>
      <pubDate>Sun, 08 Jan 2012 15:23:03 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-save-shipment-information-of-order-programatically/</guid>
      <description>&lt;p&gt;After creating invoice and shipment, it is necessary to add tracking information to shipment. Here is how to write a observer which will invoke as shipment save method is called and save tracking information programatically.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;config.xml&lt;/strong&gt; – under global -&amp;gt; events node&lt;br&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;sales_order_shipment_save_before&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;observers&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;namespace_modulename_ship_before&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;type&amp;gt;&lt;/span&gt;singleton&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;class&amp;gt;&lt;/span&gt;Namespace_Modulename_Model_Observer&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/class&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;method&amp;gt;&lt;/span&gt;salesOrderShipmentSaveBefore&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/method&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/namespace_modulename_ship_before&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/observers&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/sales_order_shipment_save_before&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Observer.php&lt;/strong&gt; -&amp;gt; under Model directory of module&lt;br&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;salesOrderShipmentSaveBefore&lt;/span&gt;(&lt;span style=&#34;color:#b8860b&#34;&gt;$observer&lt;/span&gt;)  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; {  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$shipment&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$observer&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getEvent&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getShipment&lt;/span&gt;();  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$track&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; Mage&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getModel&lt;/span&gt;(‘sales&lt;span style=&#34;color:#666&#34;&gt;/&lt;/span&gt;order_shipment_track’)  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;setNumber&lt;/span&gt;(‘824343454454’) &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//tracking number / awb number  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;setCarrierCode&lt;/span&gt;(‘aramex’) &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//carrier code  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;setTitle&lt;/span&gt;(‘Aramex’); &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//carrier title  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$shipment&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addTrack&lt;/span&gt;(&lt;span style=&#34;color:#b8860b&#34;&gt;$track&lt;/span&gt;);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; }&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>After creating invoice and shipment, it is necessary to add tracking information to shipment. Here is how to write a observer which will invoke as shipment save method is called and save tracking information programatically.</p>
<p><strong>config.xml</strong> – under global -&gt; events node<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;sales_order_shipment_save_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;namespace_modulename_ship_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;type&gt;</span>singleton<span style="color:#008000;font-weight:bold">&lt;/type&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;class&gt;</span>Namespace_Modulename_Model_Observer<span style="color:#008000;font-weight:bold">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;method&gt;</span>salesOrderShipmentSaveBefore<span style="color:#008000;font-weight:bold">&lt;/method&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/namespace_modulename_ship_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/sales_order_shipment_save_before&gt;</span></span></span></code></pre></div></p>
<p><strong>Observer.php</strong> -&gt; under Model directory of module<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">salesOrderShipmentSaveBefore</span>(<span style="color:#b8860b">$observer</span>)  
</span></span><span style="display:flex;"><span> {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$shipment</span> <span style="color:#666">=</span> <span style="color:#b8860b">$observer</span><span style="color:#666">-&gt;</span><span style="color:#b44">getEvent</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getShipment</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$track</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘sales<span style="color:#666">/</span>order_shipment_track’)  
</span></span><span style="display:flex;"><span> <span style="color:#666">-&gt;</span><span style="color:#b44">setNumber</span>(‘824343454454’) <span style="color:#080;font-style:italic">//tracking number / awb number  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span> <span style="color:#666">-&gt;</span><span style="color:#b44">setCarrierCode</span>(‘aramex’) <span style="color:#080;font-style:italic">//carrier code  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span> <span style="color:#666">-&gt;</span><span style="color:#b44">setTitle</span>(‘Aramex’); <span style="color:#080;font-style:italic">//carrier title  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span> <span style="color:#b8860b">$shipment</span><span style="color:#666">-&gt;</span><span style="color:#b44">addTrack</span>(<span style="color:#b8860b">$track</span>);  
</span></span><span style="display:flex;"><span> }</span></span></code></pre></div></p>
]]></content:encoded>
    </item>
    <item>
      <title>Magento: Wrong count in admin Grid when using GROUP BY clause, overriding lib module</title>
      <link>http://localhost:1313/magento-wrong-count-in-admin-grid-when-using-group-by-clause-overriding-lib-module/</link>
      <pubDate>Thu, 05 Jan 2012 09:47:31 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-wrong-count-in-admin-grid-when-using-group-by-clause-overriding-lib-module/</guid>
      <description>&lt;p&gt;If you have noticed or not, in version 1.5 of Magento when you use GROUP BY clause in any Grid.php file in admin, the count always display wrong. Many times it displays 1 even if there are hundreds of records. Due to this your pagination also doesn’t work. This is a bug in Magento. Your getSize() always returns wrong count whereas total records in grid are proper.&lt;/p&gt;&#xA;&lt;p&gt;To fix this, you need to edit one of your core file. As it’s not a good practice to edit core file, we will here override the core file.&lt;br&gt;&#xA;Overriding LIB module&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>If you have noticed or not, in version 1.5 of Magento when you use GROUP BY clause in any Grid.php file in admin, the count always display wrong. Many times it displays 1 even if there are hundreds of records. Due to this your pagination also doesn’t work. This is a bug in Magento. Your getSize() always returns wrong count whereas total records in grid are proper.</p>
<p>To fix this, you need to edit one of your core file. As it’s not a good practice to edit core file, we will here override the core file.<br>
Overriding LIB module</p>
<p>Copy Db.php file from magento / lib / Varien / Data / Collection / Db.php<br>
Paste it to your local directory so the resultant folder structure would look like this:<br>
magento / app / code / local / Varien / Data / Collection / Db.php</p>
<p>Now open this file to edit and replace getSelectCountSql function with below one<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">getSelectCountSql</span>()  
</span></span><span style="display:flex;"><span> {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$this</span><span style="color:#666">-&gt;</span><span style="color:#b44">_renderFilters</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span> <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">clone</span> <span style="color:#b8860b">$this</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">reset</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">ORDER</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">reset</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">LIMIT_COUNT</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">reset</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">LIMIT_OFFSET</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">reset</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">COLUMNS</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">if</span>(count(<span style="color:#b8860b">$this</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getPart</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">GROUP</span>)) <span style="color:#666">&gt;</span> <span style="color:#666">0</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">reset</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">GROUP</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">distinct</span>(<span style="color:#a2f;font-weight:bold">true</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$group</span> <span style="color:#666">=</span> <span style="color:#b8860b">$this</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getPart</span>(Zend_Db_Select<span style="color:#666">::</span><span style="color:#b44">GROUP</span>);  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">columns</span>(“COUNT(DISTINCT “<span style="color:#666">.</span>implode(“, “, <span style="color:#b8860b">$group</span>)<span style="color:#666">.</span>”)”);  
</span></span><span style="display:flex;"><span> } <span style="color:#a2f;font-weight:bold">else</span> {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$countSelect</span><span style="color:#666">-&gt;</span><span style="color:#b44">columns</span>(‘COUNT(<span style="color:#666">*</span>)’);  
</span></span><span style="display:flex;"><span> }  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#b8860b">$countSelect</span>;  
</span></span><span style="display:flex;"><span> }</span></span></code></pre></div></p>
<p><em>Updated the method for generic use</em></p>
]]></content:encoded>
    </item>
    <item>
      <title>Magento: Joining/group by &amp;#8211; order, invoice, shipment tables</title>
      <link>http://localhost:1313/magento-joining/group-by-%238211-order-invoice-shipment-tables/</link>
      <pubDate>Sat, 31 Dec 2011 11:09:45 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-joining/group-by-%238211-order-invoice-shipment-tables/</guid>
      <description>&lt;p&gt;Ever tried to join multiple tables in Magento? Joining and grouping tables is not that easy in Magento ORM than in simple MySql way we did for years.&lt;/p&gt;&#xA;&lt;p&gt;Here is a piece of code where I was required to grab all the data from orders, invoices, shipments to generate reports for warehouse people to make their life easier.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; Mage&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getResourceModel&lt;/span&gt;(‘sales&lt;span style=&#34;color:#666&#34;&gt;/&lt;/span&gt;order_shipment_item_collection’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addFieldToSelect&lt;/span&gt;(‘section_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addFieldToSelect&lt;/span&gt;(‘shelf_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addFieldToSelect&lt;/span&gt;(‘rack_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addFieldToSelect&lt;/span&gt;(‘box_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//$collection-&amp;gt;addFieldToSelect(‘GROUP_CONCAT(DISTINCT main_table.product_id SEPARATOR “,”)’,’product_ids’);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_shipment_grid’, ‘main_table&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;parent_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_shipment_grid&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;entity_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘increment_id &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; shipment_increment_id’, ‘created_at &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; shipment_created_at’, ‘order_increment_id’,’total_qty’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_shipment_track’, ‘sales_flat_shipment_grid&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;entity_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_shipment_track&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;parent_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘number &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; track_id’, ‘carrier_code &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; carrier_name’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_order’, ‘sales_flat_shipment_track&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_order&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;entity_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘created_at &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; order_created_at’,’grand_total &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; ord_grand_total’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_order_item’, ‘main_table&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_item_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_order_item&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;item_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘product_type’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_order_payment’, ‘sales_flat_shipment_track&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_order_payment&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;parent_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘method &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;as&lt;/span&gt; payment_method’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_order_address’, ‘sales_flat_shipment_track&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_order_address&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;parent_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘firstname’,’lastname’,’street’,’city’,’postcode’,’region’,’telephone’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;joinLeft&lt;/span&gt;(‘sales_flat_invoice’, ‘sales_flat_shipment_track&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sales_flat_invoice&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;order_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘grand_total’));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//$collection-&amp;gt;addAttributeToFilter(‘main_table.price’, array(‘gt’ =&amp;gt; 0));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#b8860b&#34;&gt;$pickup_ids&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt;” &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;amp;&lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;amp; is_array(&lt;span style=&#34;color:#b8860b&#34;&gt;$pickup_ids&lt;/span&gt;))  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;addAttributeToFilter&lt;/span&gt;(‘sales_flat_shipment_grid&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;entity_id’, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘in’ &lt;span style=&#34;color:#666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#b8860b&#34;&gt;$pickup_ids&lt;/span&gt;));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;columns&lt;/span&gt;(  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘product_ids’ &lt;span style=&#34;color:#666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;new&lt;/span&gt; Zend_Db_Expr(  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; “IFNULL(GROUP_CONCAT(DISTINCT main_table&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;product_id SEPARATOR ‘;’), ”)”  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;columns&lt;/span&gt;(  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;array&lt;/span&gt;(‘weight’ &lt;span style=&#34;color:#666&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;new&lt;/span&gt; Zend_Db_Expr(  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; “IFNULL(SUM(main_table&lt;span style=&#34;color:#666&#34;&gt;.&lt;/span&gt;weight)&lt;span style=&#34;color:#666&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;2&lt;/span&gt;, ”)”  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)));  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;getSelect&lt;/span&gt;()&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;group&lt;/span&gt;(‘shipment_increment_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//$collection-&amp;gt;getSelect()-&amp;gt;group(‘track_id’);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//Mage::log($collection-&amp;gt;getSelect()-&amp;gt;__toString());  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#b8860b&#34;&gt;$this&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;setCollection&lt;/span&gt;(&lt;span style=&#34;color:#b8860b&#34;&gt;$collection&lt;/span&gt;);  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;//$this-&amp;gt;getCollection()-&amp;gt;getSelect()-&amp;gt;limit();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Although the query is so expensive, I have not yet tried to optimize it due to lack of time.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Ever tried to join multiple tables in Magento? Joining and grouping tables is not that easy in Magento ORM than in simple MySql way we did for years.</p>
<p>Here is a piece of code where I was required to grab all the data from orders, invoices, shipments to generate reports for warehouse people to make their life easier.</p>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#b8860b">$collection</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getResourceModel</span>(‘sales<span style="color:#666">/</span>order_shipment_item_collection’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘section_id’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘shelf_id’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘rack_id’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘box_id’);  
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//$collection-&gt;addFieldToSelect(‘GROUP_CONCAT(DISTINCT main_table.product_id SEPARATOR “,”)’,’product_ids’);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_shipment_grid’, ‘main_table<span style="color:#666">.</span>parent_id <span style="color:#666">=</span> sales_flat_shipment_grid<span style="color:#666">.</span>entity_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘increment_id <span style="color:#a2f;font-weight:bold">as</span> shipment_increment_id’, ‘created_at <span style="color:#a2f;font-weight:bold">as</span> shipment_created_at’, ‘order_increment_id’,’total_qty’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_shipment_track’, ‘sales_flat_shipment_grid<span style="color:#666">.</span>entity_id <span style="color:#666">=</span> sales_flat_shipment_track<span style="color:#666">.</span>parent_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘number <span style="color:#a2f;font-weight:bold">as</span> track_id’, ‘carrier_code <span style="color:#a2f;font-weight:bold">as</span> carrier_name’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_order’, ‘sales_flat_shipment_track<span style="color:#666">.</span>order_id <span style="color:#666">=</span> sales_flat_order<span style="color:#666">.</span>entity_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘created_at <span style="color:#a2f;font-weight:bold">as</span> order_created_at’,’grand_total <span style="color:#a2f;font-weight:bold">as</span> ord_grand_total’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_order_item’, ‘main_table<span style="color:#666">.</span>order_item_id <span style="color:#666">=</span> sales_flat_order_item<span style="color:#666">.</span>item_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘product_type’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_order_payment’, ‘sales_flat_shipment_track<span style="color:#666">.</span>order_id <span style="color:#666">=</span> sales_flat_order_payment<span style="color:#666">.</span>parent_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘method <span style="color:#a2f;font-weight:bold">as</span> payment_method’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_order_address’, ‘sales_flat_shipment_track<span style="color:#666">.</span>order_id <span style="color:#666">=</span> sales_flat_order_address<span style="color:#666">.</span>parent_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘firstname’,’lastname’,’street’,’city’,’postcode’,’region’,’telephone’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinLeft</span>(‘sales_flat_invoice’, ‘sales_flat_shipment_track<span style="color:#666">.</span>order_id <span style="color:#666">=</span> sales_flat_invoice<span style="color:#666">.</span>order_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘grand_total’));  
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//$collection-&gt;addAttributeToFilter(‘main_table.price’, array(‘gt’ =&gt; 0));  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span><span style="color:#a2f;font-weight:bold">if</span>(<span style="color:#b8860b">$pickup_ids</span><span style="color:#666">!=</span>” <span style="color:#666">&amp;</span>amp;<span style="color:#666">&amp;</span>amp; is_array(<span style="color:#b8860b">$pickup_ids</span>))  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">addAttributeToFilter</span>(‘sales_flat_shipment_grid<span style="color:#666">.</span>entity_id’, <span style="color:#a2f;font-weight:bold">array</span>(‘in’ <span style="color:#666">=&gt;</span> <span style="color:#b8860b">$pickup_ids</span>));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">columns</span>(  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">array</span>(‘product_ids’ <span style="color:#666">=&gt;</span> <span style="color:#a2f;font-weight:bold">new</span> Zend_Db_Expr(  
</span></span><span style="display:flex;"><span> “IFNULL(GROUP_CONCAT(DISTINCT main_table<span style="color:#666">.</span>product_id SEPARATOR ‘;’), ”)”  
</span></span><span style="display:flex;"><span>)));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">columns</span>(  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">array</span>(‘weight’ <span style="color:#666">=&gt;</span> <span style="color:#a2f;font-weight:bold">new</span> Zend_Db_Expr(  
</span></span><span style="display:flex;"><span> “IFNULL(SUM(main_table<span style="color:#666">.</span>weight)<span style="color:#666">/</span><span style="color:#666">2</span>, ”)”  
</span></span><span style="display:flex;"><span>)));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$collection</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">group</span>(‘shipment_increment_id’);  
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//$collection-&gt;getSelect()-&gt;group(‘track_id’);  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//Mage::log($collection-&gt;getSelect()-&gt;__toString());  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span><span style="color:#b8860b">$this</span><span style="color:#666">-&gt;</span><span style="color:#b44">setCollection</span>(<span style="color:#b8860b">$collection</span>);  
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//$this-&gt;getCollection()-&gt;getSelect()-&gt;limit();
</span></span></span></code></pre></div>
<p>Although the query is so expensive, I have not yet tried to optimize it due to lack of time.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Magento Admin &amp;#8211; Forcing Invoice and Ship button together</title>
      <link>http://localhost:1313/magento-admin-%238211-forcing-invoice-and-ship-button-together/</link>
      <pubDate>Sat, 31 Dec 2011 10:41:25 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-admin-%238211-forcing-invoice-and-ship-button-together/</guid>
      <description>&lt;p&gt;Ever wondered what if you want to do invoice and shipment with just one click in your website admin? Yes, Magento allows you to integrate both these in one step.&lt;/p&gt;&#xA;&lt;p&gt;Edit your module’s config.xml and Observer.php for this to happen.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;config.xml&lt;/strong&gt; snippet:&lt;br&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;events&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;sales_order_place_after&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;observers&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;namespace_module&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;type&amp;gt;&lt;/span&gt;singleton&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;class&amp;gt;&lt;/span&gt;Namespace_Module_Model_Observer&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/class&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;method&amp;gt;&lt;/span&gt;doForceInvoiceWithShipment&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/method&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/namespace_module&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/observers&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/sales_order_place_after&amp;gt;&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;&amp;lt;/events&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br&gt;&#xA;Every time a order is placed, frontend as well as backend, your observer method will be called which will force invoice and shipment to show in one button in Manage Orders for particular order at backend.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Ever wondered what if you want to do invoice and shipment with just one click in your website admin? Yes, Magento allows you to integrate both these in one step.</p>
<p>Edit your module’s config.xml and Observer.php for this to happen.</p>
<p><strong>config.xml</strong> snippet:<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;events&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;sales_order_place_after&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;namespace_module&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;type&gt;</span>singleton<span style="color:#008000;font-weight:bold">&lt;/type&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;class&gt;</span>Namespace_Module_Model_Observer<span style="color:#008000;font-weight:bold">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;method&gt;</span>doForceInvoiceWithShipment<span style="color:#008000;font-weight:bold">&lt;/method&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/namespace_module&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/sales_order_place_after&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;/events&gt;</span></span></span></code></pre></div><br>
Every time a order is placed, frontend as well as backend, your observer method will be called which will force invoice and shipment to show in one button in Manage Orders for particular order at backend.</p>
<p><strong>Observer.php</strong> snippet:<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">doForceInvoiceWithShipment</span>(<span style="color:#b8860b">$observer</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$order</span> <span style="color:#666">=</span> <span style="color:#b8860b">$observer</span><span style="color:#666">-&gt;</span><span style="color:#b44">getOrder</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$orderId</span> <span style="color:#666">=</span> <span style="color:#b8860b">$order</span><span style="color:#666">-&gt;</span><span style="color:#b44">getIncrementId</span>();  
</span></span><span style="display:flex;"><span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘sales<span style="color:#666">/</span>order’)<span style="color:#666">-&gt;</span><span style="color:#b44">loadByIncrementId</span>(<span style="color:#b8860b">$orderId</span>)<span style="color:#666">-&gt;</span><span style="color:#b44">setForcedDoShipmentWithInvoice</span>(<span style="color:#a2f;font-weight:bold">true</span>)<span style="color:#666">-&gt;</span><span style="color:#b44">save</span>();  
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></p>
<p>Now you can place a order and check at backend under Sales-&gt;Orders clicking on latest order to see “Invoice &amp; Ship” button integrated rather than “Invoice” and “Ship” button separated.</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
