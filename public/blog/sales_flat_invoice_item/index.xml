<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Sales_flat_invoice_item on KALPESH MEHTA</title>
    <link>http://localhost:1313/blog/sales_flat_invoice_item/</link>
    <description>Recent content in Sales_flat_invoice_item on KALPESH MEHTA</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <managingEditor>k@lpe.sh (Kalpesh Mehta)</managingEditor>
    <webMaster>k@lpe.sh (Kalpesh Mehta)</webMaster>
    <copyright>Copyright © 2025 kalpesh mehta</copyright>
    <lastBuildDate>Tue, 17 Jan 2012 17:01:13 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/blog/sales_flat_invoice_item/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Magento: Adding column to sales_flat_order_item, sales_flat_invoice_item and sales_flat_shipment_item</title>
      <link>http://localhost:1313/magento-adding-column-to-sales_flat_order_item-sales_flat_invoice_item-and-sales_flat_shipment_item/</link>
      <pubDate>Tue, 17 Jan 2012 17:01:13 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-adding-column-to-sales_flat_order_item-sales_flat_invoice_item-and-sales_flat_shipment_item/</guid>
      <description>&lt;p&gt;Suppose you want to add column to some table before it gets save in Magento. Example, Magento doesn’t save regular price of product when an order is placed, it only saves the selling price. So if your product have some special price in it, then Magento only saves it’s special price when an order is placed, so there is no track of regular price of that product in order item table. Same it goes to invoice item and shipment item. When creating invoice and shipment, Magento doesn’t have any track on the regular price of invoiced item’s and shipment item’s regular price.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Suppose you want to add column to some table before it gets save in Magento. Example, Magento doesn’t save regular price of product when an order is placed, it only saves the selling price. So if your product have some special price in it, then Magento only saves it’s special price when an order is placed, so there is no track of regular price of that product in order item table. Same it goes to invoice item and shipment item. When creating invoice and shipment, Magento doesn’t have any track on the regular price of invoiced item’s and shipment item’s regular price.</p>
<p>So here I show you how you will add a column “product_mrp” in each of 3 tables and update the information without firing any query!</p>
<p>First of all, make an installer script in your module that will alter these three tables and add column “product_mrp” or any of your choice.</p>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#666">&lt;?</span>php <span style="color:#b8860b">$installer</span> <span style="color:#666">=</span> <span style="color:#b8860b">$this</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$installer</span><span style="color:#666">-&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#b44">startSetup</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$installer</span><span style="color:#666">-&gt;</span><span style="color:#b44">run</span>(”  
</span></span><span style="display:flex;"><span> ALTER TABLE sales_flat_order_item ADD COLUMN product_mrp DECIMAL(<span style="color:#666">12</span>,<span style="color:#666">4</span>) <span style="color:#a2f;font-weight:bold">NULL</span>;  
</span></span><span style="display:flex;"><span> ALTER TABLE sales_flat_invoice_item ADD COLUMN product_mrp DECIMAL(<span style="color:#666">12</span>,<span style="color:#666">4</span>) <span style="color:#a2f;font-weight:bold">NULL</span>;  
</span></span><span style="display:flex;"><span> ALTER TABLE sales_flat_shipment_item ADD COLUMN product_mrp DECIMAL(<span style="color:#666">12</span>,<span style="color:#666">4</span>) <span style="color:#a2f;font-weight:bold">NULL</span>;  
</span></span><span style="display:flex;"><span>“);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$installer</span><span style="color:#666">-&gt;</span><span style="color:#b44">endSetup</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080">?&gt;</span><span style="">
</span></span></span></code></pre></div>
<p>After this is executed, you will find your columns added at the end of your tables.<br>
Now we will catch the event before order is placed, before invoice is created and before shipment is saved.</p>
<p><strong>config.xml</strong><br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;sales_order_place_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;adding_product_mrp_order&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;type&gt;</span>singleton<span style="color:#008000;font-weight:bold">&lt;/type&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;class&gt;</span>Namespace_Module_Model_Observer<span style="color:#008000;font-weight:bold">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;method&gt;</span>saveProductMrpInOrder<span style="color:#008000;font-weight:bold">&lt;/method&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/adding_product_mrp_order&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/sales_order_place_before&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;sales_order_invoice_save_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;adding_product_mrp_invoice&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;type&gt;</span>singleton<span style="color:#008000;font-weight:bold">&lt;/type&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;class&gt;</span>Namespace_Module_Model_Observer<span style="color:#008000;font-weight:bold">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;method&gt;</span>saveProductMrpInInvoice<span style="color:#008000;font-weight:bold">&lt;/method&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/adding_product_mrp_invoice&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/sales_order_invoice_save_before&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;sales_order_shipment_save_before&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;adding_product_mrp_shipment&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;type&gt;</span>singleton<span style="color:#008000;font-weight:bold">&lt;/type&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;class&gt;</span>Namespace_Module_Model_Observer<span style="color:#008000;font-weight:bold">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;method&gt;</span>saveProductMrpInShipment<span style="color:#008000;font-weight:bold">&lt;/method&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/adding_product_mrp_shipment&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/observers&gt;</span>  
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/sales_order_shipment_save_before&gt;</span></span></span></code></pre></div></p>
<p>Now comes the Observer part that will add our column data before data is actually saved in table.</p>
<p><strong>Observer.php</strong><br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">saveProductMrpInOrder</span>(Varien_Event_Observer <span style="color:#b8860b">$observer</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$order</span> <span style="color:#666">=</span> <span style="color:#b8860b">$observer</span><span style="color:#666">-&gt;</span><span style="color:#b44">getEvent</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getOrder</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">foreach</span>(<span style="color:#b8860b">$order</span><span style="color:#666">-&gt;</span><span style="color:#b44">getAllItems</span>() <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#b8860b">$item</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$price</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘catalog<span style="color:#666">/</span>product’)<span style="color:#666">-&gt;</span><span style="color:#b44">load</span>(<span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">getId</span>())<span style="color:#666">-&gt;</span><span style="color:#b44">getPrice</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">setProductMrp</span>(<span style="color:#b8860b">$price</span>);  
</span></span><span style="display:flex;"><span> }  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#b8860b">$this</span>;  
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">saveProductMrpInInvoice</span>(Varien_Event_Observer <span style="color:#b8860b">$observer</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$invoice</span> <span style="color:#666">=</span> <span style="color:#b8860b">$observer</span><span style="color:#666">-&gt;</span><span style="color:#b44">getEvent</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getInvoice</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">foreach</span>(<span style="color:#b8860b">$invoice</span><span style="color:#666">-&gt;</span><span style="color:#b44">getAllItems</span>() <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#b8860b">$item</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$price</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘catalog<span style="color:#666">/</span>product’)<span style="color:#666">-&gt;</span><span style="color:#b44">load</span>(<span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">getProductId</span>())<span style="color:#666">-&gt;</span><span style="color:#b44">getPrice</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">setProductMrp</span>(<span style="color:#b8860b">$price</span>);  
</span></span><span style="display:flex;"><span> }  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#b8860b">$this</span>;  
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">function</span> <span style="color:#00a000">saveProductMrpInShipment</span>(Varien_Event_Observer <span style="color:#b8860b">$observer</span>)  
</span></span><span style="display:flex;"><span> {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$shipment</span> <span style="color:#666">=</span> <span style="color:#b8860b">$observer</span><span style="color:#666">-&gt;</span><span style="color:#b44">getEvent</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">getShipment</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">foreach</span>(<span style="color:#b8860b">$shipment</span><span style="color:#666">-&gt;</span><span style="color:#b44">getAllItems</span>() <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#b8860b">$item</span>) {  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$product</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘catalog<span style="color:#666">/</span>product’)<span style="color:#666">-&gt;</span><span style="color:#b44">load</span>(<span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">getProductId</span>());  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$price</span> <span style="color:#666">=</span> <span style="color:#b8860b">$product</span><span style="color:#666">-&gt;</span><span style="color:#b44">getPrice</span>();  
</span></span><span style="display:flex;"><span> <span style="color:#b8860b">$item</span><span style="color:#666">-&gt;</span><span style="color:#b44">product_mrp</span> <span style="color:#666">=</span> <span style="color:#b8860b">$price</span>;  
</span></span><span style="display:flex;"><span> }  
</span></span><span style="display:flex;"><span> }</span></span></code></pre></div></p>
<p>Now clear the cache, and place order and create it’s invoice and shipment. You will find the regular price of each of your products in all these three useful tables and hence you can track the original price information even if your product’s price has been changed afterwards.</p>
<p>Happy coding!</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
