<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Reset Downloads Order Item on KALPESH MEHTA</title>
    <link>http://localhost:1313/blog/reset-downloads-order-item/</link>
    <description>Recent content in Reset Downloads Order Item on KALPESH MEHTA</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <managingEditor>k@lpe.sh (Kalpesh Mehta)</managingEditor>
    <webMaster>k@lpe.sh (Kalpesh Mehta)</webMaster>
    <copyright>Copyright © 2025 kalpesh mehta</copyright>
    <lastBuildDate>Wed, 20 Feb 2013 08:21:32 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/blog/reset-downloads-order-item/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Magento: Reset download limit for downloadable product item/order</title>
      <link>http://localhost:1313/magento-reset-download-limit-for-downloadable-product-item/order/</link>
      <pubDate>Wed, 20 Feb 2013 08:21:32 +0000</pubDate><author>k@lpe.sh (Kalpesh Mehta)</author>
      <guid>http://localhost:1313/magento-reset-download-limit-for-downloadable-product-item/order/</guid>
      <description>&lt;p&gt;In Magento, downloadable products are the products which can be downloaded and does not require any shipping. When customer purchases this type of products, they get certain download limits to download their purchased items. This can be set in Products page in admin under “Downloadable Products” tab. In many cases store owner only want to give certain amount of downloads, so customers can’t download beyond that limit. But it may happen that due to bad internet or some interrupts downloads can’t be successful and customer want to reset that limit. For doing this, there is no option in backend to reset the download limits for the downloadable product items or for an entire order, and unfortunately admin use to re-order to achieve this.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>In Magento, downloadable products are the products which can be downloaded and does not require any shipping. When customer purchases this type of products, they get certain download limits to download their purchased items. This can be set in Products page in admin under “Downloadable Products” tab. In many cases store owner only want to give certain amount of downloads, so customers can’t download beyond that limit. But it may happen that due to bad internet or some interrupts downloads can’t be successful and customer want to reset that limit. For doing this, there is no option in backend to reset the download limits for the downloadable product items or for an entire order, and unfortunately admin use to re-order to achieve this.</p>
<p>Here is the query which will reset download limits for an entire order.<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#b8860b">$q</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘sales<span style="color:#666">/</span>order_item’)<span style="color:#666">-&gt;</span><span style="color:#b44">getCollection</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘order_id’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinRight</span>(‘downloadable_link_purchased_item <span style="color:#a2f;font-weight:bold">as</span> d’, ‘main_table<span style="color:#666">.</span>item_id <span style="color:#666">=</span> d<span style="color:#666">.</span>order_item_id’,  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">array</span>(‘item_id’,’number_of_downloads_used’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">where</span>(‘main_table<span style="color:#666">.</span>order_id <span style="color:#666">=</span> ‘<span style="color:#666">.</span> (int)<span style="color:#b8860b">$orderId</span>);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">load</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//echo $q-&gt;getSelect()-&gt;__toString();exit;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$items</span> <span style="color:#666">=</span> <span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getColumnValues</span>(‘item_id’);  
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">foreach</span>(<span style="color:#b8860b">$items</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#b8860b">$id</span>) {  
</span></span><span style="display:flex;"><span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘downloadable<span style="color:#666">/</span>link_purchased_item’)<span style="color:#666">-&gt;</span><span style="color:#b44">load</span>(<span style="color:#b8860b">$id</span>)  
</span></span><span style="display:flex;"><span> <span style="color:#666">-&gt;</span><span style="color:#b44">setStatus</span>(‘available’)<span style="color:#666">-&gt;</span><span style="color:#b44">setNumberOfDownloadsUsed</span>(<span style="color:#666">0</span>)<span style="color:#666">-&gt;</span><span style="color:#b44">save</span>();  
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></p>
<p>The raw SQL query for the above Magento Convention query is:<br>
UPDATE sales_flat_order_item s RIGHT JOIN downloadable_link_purchased_item d ON s.item_id = d.order_item_id SET d.number_of_downloads_used = 0 WHERE s.order_id = $orderId;</p>
<p>Here is another query that will allow you to reset download limits for a particular item in an order<br>




<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#b8860b">$q</span> <span style="color:#666">=</span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘sales<span style="color:#666">/</span>order_item’)<span style="color:#666">-&gt;</span><span style="color:#b44">getCollection</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">addFieldToSelect</span>(‘order_id’);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">joinRight</span>(‘downloadable_link_purchased_item <span style="color:#a2f;font-weight:bold">as</span> d’, ‘main_table<span style="color:#666">.</span>item_id <span style="color:#666">=</span> d<span style="color:#666">.</span>order_item_id’,  
</span></span><span style="display:flex;"><span> <span style="color:#a2f;font-weight:bold">array</span>(‘item_id’,’number_of_downloads_used’));  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getSelect</span>()<span style="color:#666">-&gt;</span><span style="color:#b44">where</span>(‘main_table<span style="color:#666">.</span>order_id <span style="color:#666">=</span> ‘<span style="color:#666">.</span> (int)<span style="color:#b8860b">$orderId</span> <span style="color:#666">.</span>’ <span style="color:#a2f;font-weight:bold">AND</span> main_table<span style="color:#666">.</span>item_id <span style="color:#666">=</span> ‘<span style="color:#666">.</span> (int)<span style="color:#b8860b">$orderItemId</span>);  
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">load</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">//echo $q-&gt;getSelect()-&gt;__toString();exit;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">$items</span> <span style="color:#666">=</span> <span style="color:#b8860b">$q</span><span style="color:#666">-&gt;</span><span style="color:#b44">getColumnValues</span>(‘item_id’);  
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">foreach</span>(<span style="color:#b8860b">$items</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#b8860b">$id</span>) {  
</span></span><span style="display:flex;"><span> Mage<span style="color:#666">::</span><span style="color:#b44">getModel</span>(‘downloadable<span style="color:#666">/</span>link_purchased_item’)<span style="color:#666">-&gt;</span><span style="color:#b44">load</span>(<span style="color:#b8860b">$id</span>)  
</span></span><span style="display:flex;"><span> <span style="color:#666">-&gt;</span><span style="color:#b44">setStatus</span>(‘available’)<span style="color:#666">-&gt;</span><span style="color:#b44">setNumberOfDownloadsUsed</span>(<span style="color:#666">0</span>)<span style="color:#666">-&gt;</span><span style="color:#b44">save</span>();  
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></p>
<p>The raw SQL query for the above Magento Convention query is:<br>
UPDATE sales_flat_order_item s RIGHT JOIN downloadable_link_purchased_item d ON s.item_id = d.order_item_id SET d.number_of_downloads_used = 0 WHERE s.order_id = $orderId AND s.item_id = $orderItemId;</p>
<p>HTH!</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
