<!DOCTYPE html>
<html lang="en-US">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="http://localhost:1313/images/favicon.png" />
<title>Magento: Zipcode &#43; 4 tax calculation bug fix | Kalpesh Mehta&#39;s Blog</title>
<meta name="title" content="Magento: Zipcode &#43; 4 tax calculation bug fix" />
<meta name="description" content="Magento bug fix for zipcode &#43; 4 in tax calculation
Tax Calculation in Magento has a bug where customer can escape paying tax if they enter zipcode &#43; 4 digit in USA. This is because you import 5 digit zipcodes with their tax rates in Magento admin, so if customer inputs their zipcode in zipcode&#43;4 format their zipcode will not match with the imported one. Importing 5-digit zipcode ending in wildcard (*) does not solve this issue either." />
<meta name="author" content="kalpesh" />
<meta name="keywords" content="bug,calculation,magento,tax," />






  





  













<meta property="og:title" content="Magento: Zipcode &#43; 4 tax calculation bug fix" />
<meta property="og:description" content="Magento bug fix for zipcode &#43; 4 in tax calculation
Tax Calculation in Magento has a bug where customer can escape paying tax if they enter zipcode &#43; 4 digit in USA. This is because you import 5 digit zipcodes with their tax rates in Magento admin, so if customer inputs their zipcode in zipcode&#43;4 format their zipcode will not match with the imported one. Importing 5-digit zipcode ending in wildcard (*) does not solve this issue either." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/2015-09-04-magento-zipcode-4-tax-calculation-bug-fix/" />

<meta property="og:image" content="http://localhost:1313/images/social_card_bg_hu_271c3d0b91a96062.webp"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-09-04T05:39:10+00:00" />
<meta property="article:modified_time" content="2015-09-04T05:39:10+00:00" /><meta property="og:site_name" content="Kalpesh Mehta" />
<meta property="fb:admins" content="0000000000" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://localhost:1313/images/social_card_bg_hu_271c3d0b91a96062.webp"/>
<meta name="twitter:title" content="Magento: Zipcode &#43; 4 tax calculation bug fix"/>
<meta name="twitter:description" content="Magento bug fix for zipcode &#43; 4 in tax calculation
Tax Calculation in Magento has a bug where customer can escape paying tax if they enter zipcode &#43; 4 digit in USA. This is because you import 5 digit zipcodes with their tax rates in Magento admin, so if customer inputs their zipcode in zipcode&#43;4 format their zipcode will not match with the imported one. Importing 5-digit zipcode ending in wildcard (*) does not solve this issue either."/>
<meta name="twitter:site" content="@kalpmehta"/>



<meta itemprop="name" content="Magento: Zipcode &#43; 4 tax calculation bug fix">
<meta itemprop="description" content="Magento bug fix for zipcode &#43; 4 in tax calculation
Tax Calculation in Magento has a bug where customer can escape paying tax if they enter zipcode &#43; 4 digit in USA. This is because you import 5 digit zipcodes with their tax rates in Magento admin, so if customer inputs their zipcode in zipcode&#43;4 format their zipcode will not match with the imported one. Importing 5-digit zipcode ending in wildcard (*) does not solve this issue either."><meta itemprop="datePublished" content="2015-09-04T05:39:10+00:00" />
<meta itemprop="dateModified" content="2015-09-04T05:39:10+00:00" />
<meta itemprop="wordCount" content="215">

<meta itemprop="image" content="http://localhost:1313/images/social_card_bg_hu_271c3d0b91a96062.webp"/>


<meta itemprop="keywords" content="bug,calculation,magento,tax," />

<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="/original.min.css" rel="stylesheet">

  

  

  
</head>

<body>
  <header><a class="skip-link" href="#main-content">Skip to main content</a>

<a href="/" class="title"><h1>Kalpesh Mehta&#39;s Blog</h1></a>
<nav>
<a href='http://localhost:1313/'>Home</a>
<a href='http://localhost:1313/about-me'>About Me</a>
<a href='http://localhost:1313/contact-me'>Contact</a>
<a href='http://localhost:1313/index.xml'>RSS</a>







</nav>
</header>
  <main id="main-content">

<h1>Magento: Zipcode &#43; 4 tax calculation bug fix</h1>
<p class="byline">
  <time datetime='2015-09-04' pubdate>
    2015-09-04
  </time>
  · kalpesh
</p>

<content>
  <p>Magento bug fix for zipcode + 4 in tax calculation</p>
<p>Tax Calculation in Magento has a bug where customer can escape paying tax if they enter zipcode + 4 digit in USA. This is because you import 5 digit zipcodes with their tax rates in Magento admin, so if customer inputs their zipcode in zipcode+4 format their zipcode will not match with the imported one. Importing 5-digit zipcode ending in wildcard (*) does not solve this issue either.</p>
<p>Before this fix: If zipcode 90036 collects tax, 90036-1234 does NOT collect tax.</p>
<p>You can fix this bug by adding below code in your custom module:</p>
<p>config.xml<br>
{code}…<br>
<!-- raw HTML omitted --><br>
<!-- raw HTML omitted --><br>
&lt;tax_resource&gt;<br>
<!-- raw HTML omitted --><br>
<!-- raw HTML omitted -->Namespace_Module_Model_Tax_Resource_Calculation<!-- raw HTML omitted --><br>
<!-- raw HTML omitted --><br>
&lt;/tax_resource&gt;<br>
<!-- raw HTML omitted --><br>
<!-- raw HTML omitted --><br>
…{/code}</p>
<p>Note that we are rewriting core logic of Tax Calculation. Now create folder structure in your custom module: app/code/local/Namespace/Module/Model/Tax/Resource/Calculation.php and copy below code:</p>
<p>{code}<!-- raw HTML omitted -->
getCountryId();<br>
$regionId = $request-&gt;getRegionId();<br>
$postcode = $request-&gt;getPostcode();</p>
<p>//12 = california, 25 = iowa<br>
if($countryId == ‘US’ &amp;&amp; in_array($regionId,array(12,25))) {<br>
$postcode = substr(trim($request-&gt;getPostcode()),0,5);<br>
$request-&gt;setPostcode($postcode);<br>
}<br>
return parent::_getRates($request);</p>
<p>}</p>
<p>}{/code}</p>
<p>Above code will only take first 5 digits from the zipcode if the country is USA and state selected is either California or Iowa. You can change the states as per your requirement, to know what ID relates to different states you can look at the State/Province dropdown source code in checkout page.</p>

</content>
<p>
  
    <a class="blog-tags" href="/blog/bug/">#bug</a>
  
    <a class="blog-tags" href="/blog/calculation/">#calculation</a>
  
    <a class="blog-tags" href="/blog/magento/">#magento</a>
  
    <a class="blog-tags" href="/blog/tax/">#tax</a>
  
</p>


  <p>
    <a href='mailto:k@lpe.sh?subject=Reply%20to%20"Magento%3a%20Zipcode%20%2b%204%20tax%20calculation%20bug%20fix"'>
      Reply to this post by email ↪
    </a>
  </p>



  </main>
  <footer><small>
  Copyright © 2025, Kalpesh Mehta. | 
</small></footer>

    
</body>

</html>
